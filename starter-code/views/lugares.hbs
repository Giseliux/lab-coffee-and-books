<h1>Places</h1>
<a href="/">Inicio</a>
<ul class="list-group"></ul>{{#each places as |place|}}
<li class="list-group-item"><p>Name: {{place.name}}</p>
<p>Type: {{place.type}}</p>
<form action="/lugares" method="POST">
<a href="/delete/{{place._id}}">
<button type="button" class="btn btn-primary">Delete Lugar</button>
</a><br><br>
<a href="/update-place/{{place._id}}">
<button type="button" class="btn btn-primary">Update Lugar</button>
</a>
</form>
</li>
{{/each}}
</ul>
  <div>

      <div>
        <div id='map' style='display: inline-flex;width: 400px; height: 300px;'></div>
      </div>
      <div id="map" style="width: 600px; height: 400px"></div>
      <script>
        let input_lng = document.getElementById("lng");
        let input_lat = document.getElementById("lat");
        let input_address = document.getElementById("address")
        mapboxgl.accessToken =
          "pk.eyJ1IjoibWx6eiIsImEiOiJjanUwbTRtaTQxc3RzNDRtZmdtaXF1dXVxIn0.k3hMbEeCzUKaDn2sIsULjA";
        let map = new mapboxgl.Map({ container: "map", style: "mapbox://styles/mapbox/streets-v11" });
        let geocoder = new MapboxGeocoder({
          accessToken: mapboxgl.accessToken

        });

        document.getElementById("search").appendChild(geocoder.onAdd(map))
        geocoder.on("result", res => {
          let [lng, lat] = res.result.center;
          let address = res.result.place_name;
          input_lng.value = lng;
          input_lat.value = lat;
          input_address.value = address;
        });
        map.addControl(new mapboxgl.NavigationControl());
      </script>
    </div>
<script >
  mapboxgl.accessToken="pk.eyJ1IjoiZ2lzZWxpdXgiLCJhIjoiY2swZHhwZ3VwMGJ2eDNpbXF4bDgxY2d3dSJ9.oCz3yt20nmOFdeSKEZK8UA"
  const map = new mapboxgl.Map({
  container: "map",
  style: "mapbox://styles/mapbox/streets-v10",
});

//añadir controladores
map.addControl(new MapboxDirections({accessToken:mapboxgl.accessToken}),'top-left')
map.addControl(new mapboxgl.NavigationControl());

const marker = new mapboxgl.Marker()
    .setLngLat([-99.1711, 19.399])
    .addTo(map);

if (navigator.geolocation) {

  // Get current position
  // The permissions dialog will pop up
  navigator.geolocation.getCurrentPosition(function (position) {
    // Create an object to match Mapbox's Lat-Lng array format
    const center = [
      position.coords.longitude,
      position.coords.latitude,
    ];

    map.setZoom(12).setCenter(center);

   new mapboxgl.Marker({color:"red"})
   .setLngLat(center)
   .addTo(map)
   .setPopup(new mapboxgl.Popup().setHTML("<p>Usted està aquì </p>"))

  });
} 

let locations=[];
let names=[];
{{#each places as |place|}}
  locations.push({{{place.location}}})
  names.push("{{place.name}}")
{{/each}}

console.log(locations)

locations.forEach((place,i)=>{
  console.log(i+1,location[i])
    let [lng,lat]=place.coordinates
    let place_position=[lng,lat];
    let popup =new mapboxgl.Popup().setText(names[i]);
    let marker =new mapboxgl.Marker().setLngLat(place_position).setPopup(popup).addTo(map);
})


</script>